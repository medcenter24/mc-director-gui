<!--
  ~ Copyright (c) 2017.
  ~
  ~ @author Alexander Zagovorichev <zagovorichev@gmail.com>
  -->

<ba-card *ngIf="diagnostic" baCardClass="with-scroll" class="edit-form-container" [closeable]="true" (close)="closeEditor()">
    <form (ngSubmit)="onSubmit()" #diagnosticForm="ngForm">
        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label for="inputTitle" translate>Title</label>
                    <input type="text" class="form-control" id="inputTitle"
                           required
                           [(ngModel)]="diagnostic.title" name="title"
                           #title="ngModel"
                           placeholder="{{ 'Title' | translate }}" maxlength="70"
                    >
                    <div [hidden]="title.valid || title.pristine"
                         class="alert alert-danger"
                         translate>Title is required</div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="form-group">
                    <label for="inputComment" translate>Disease Code</label>
                    <input type="text" class="form-control" id="inputComment"
                           [(ngModel)]="diagnostic.diseaseCode" name="disease_code"
                           #comment="ngModel"
                           placeholder="{{ 'Disease Code' | translate }}" maxlength="70"
                    >
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label for="inputDescription" translate>Description</label>
                    <textarea class="form-control" id="inputDescription" placeholder="{{ 'Diagnostic description' | translate }}"
                              [(ngModel)]="diagnostic.description" name="description"
                              #description="ngModel"
                              maxlength="255"
                              [innerHTML]="diagnostic ? diagnostic.description : ''"
                    ></textarea>
                    <div [hidden]="description.valid || description.pristine"
                         class="alert alert-danger"
                         translate>Description is required</div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="form-group">
                    <nga-diagnostic-category-select
                      #diagnosticCategorySelect
                      [diagnosticCategoryId]="diagnostic.diagnosticCategoryId"
                      (selected)="onDiagnosticCategoryChanged($event)"
                      (init)="startLoader($event)"
                      (loaded)="onSelectorLoaded($event)"
                    ></nga-diagnostic-category-select>
                    <a (click)="toggleEditor(diagnostic.diagnosticCategoryId)"
                       *ngIf="showEditor" class="editor-toggle" translate>Close categories editor</a>
                    <a (click)="toggleEditor(diagnostic.diagnosticCategoryId)"
                       *ngIf="!showEditor" class="editor-toggle" translate>Open categories editor</a>
                </div>
            </div>
        </div>
        <button type="submit" class="btn btn-primary" translate>Submit</button>
    </form>
</ba-card>

<nga-diagnostic-category-editor
  #diagnosticCategoryEditor
  [hidden]="!showEditor"
  [categoryId]="diagnostic.diagnosticCategoryId"
  (init)="startLoader($event)"
  (loaded)="stopLoader($event)"
  (updated)="onDiagnosticCategorySubmit($event)"
></nga-diagnostic-category-editor>
